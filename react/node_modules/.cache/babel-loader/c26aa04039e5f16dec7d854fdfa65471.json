{"ast":null,"code":"var _this=this;import shimmer from\"shimmer\";import{AttributeNames}from\"./enum/AttributeNames\";import{getTracing}from\"./commonTracing\";import api from\"@opentelemetry/api\";import React from'react';/**Steps to follow\r\n * start the span \r\n * set te parent space by setting the actice context \r\n * */var self=this;export var UserContext=React.createContext();//  Make a copy of the original add function \nvar originalUseEffect=React.useEffect;export var _instrumentFunction=function _instrumentFunction(react,span,original){var wasError=false;try{return api.context.with(api.trace.setSpan(api.context.active(),span),function(){return original();});}catch(err){span.setAttribute(AttributeNames.REACT_ERROR,err.stack);wasError=true;throw err;}finally{span.end();}};/**\r\n     * Patches the render lifecycle method\r\n     */export var _patchUseEffect=function _patchUseEffect(){// return (original) => {\nvar plugin=_this;// return function patchUseEffect(...args) {\n//setting the span \n// const tracer = getTracing(\"example-react-load\", AttributeNames.EFFECT_SPAN);\n// tracer.end();\n// const apply = plugin._instrumentFunction(this, 'componentDidMount', tracer, () => {\n//     return original.apply(this, args);\n// });\n// return original.apply(this, args);        \n//  };\n// };\n};/**\r\n     * Patches the setState function\r\n     */export var _patchSetState=function _patchSetState(){return function(original){var plugin=_this;return function patchSetState(){var _this2=this;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}var tracer=getTracing(\"example-react-load\",AttributeNames.EFFECT_SPAN);tracer.end();//     const parentSpan = plugin._getParentSpan(this, AttributeNames_1.AttributeNames.UPDATING_SPAN);\nreturn plugin._instrumentFunction(this,'setState()',tracer,function(){return original.apply(_this2,args);});};};};/**\r\n    * patch function which wraps all the lifecycle methods\r\n    */export var patch=function patch(){console.log(\"Patch function called\");console.log(\"context\",UserContext);// // Make a copy of the original add function \n// const origUseEffect = React.useEffect;\n// React.useEffect = function() {\n//     //console.log(`Adding the result of ${a} and ${b}`);\n//     return origUseEffect();\n// }\nshimmer.wrap(React.useEffect,'useEffect',_patchUseEffect());//  shimmer.wrap(this, 'setState',_patchSetState());\n};export var tracerUseEffect=function tracerUseEffect(){console.log(\"tracerUseEffect function called\");// const origUseEffect = React.useEffect;\nReact.useEffect=function(){console.log(\"Use effect called by monkey patching\");//  return originalUseEffect();\nfor(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}return originalUseEffect.apply(React,args);};// Make a copy of the original add function \n//const origAdd = useEffect;\n//shimmer.wrap(useEffect(), 'useEffect', _patchUseEffect());\n//  shimmer.wrap(this, 'setState',_patchSetState());\n};/**\r\n    * unpatch function to unwrap all the lifecycle methods\r\n    */export var unpatch=function unpatch(){console.log(\"Unpatch method called\");shimmer.unwrap(_this,'useEffect');//   shimmer.unwrap(this, 'setState');\n// this._parentSpanMap = new WeakMap();\n};","map":{"version":3,"names":["shimmer","AttributeNames","getTracing","api","React","self","UserContext","createContext","originalUseEffect","useEffect","_instrumentFunction","react","span","original","wasError","context","with","trace","setSpan","active","err","setAttribute","REACT_ERROR","stack","end","_patchUseEffect","plugin","_patchSetState","patchSetState","args","tracer","EFFECT_SPAN","apply","patch","console","log","wrap","tracerUseEffect","unpatch","unwrap"],"sources":["C:/React/cloned telemetry/opentelemetry-js-contrib/examples/react-load/react/src/automation.jsx"],"sourcesContent":["import shimmer from \"shimmer\";\r\nimport { AttributeNames } from \"./enum/AttributeNames\";\r\nimport { getTracing } from \"./commonTracing\";\r\nimport api from \"@opentelemetry/api\";\r\nimport React from 'react';\r\n\r\n/**Steps to follow\r\n * start the span \r\n * set te parent space by setting the actice context \r\n * */\r\nconst self = this;\r\nexport const UserContext = React.createContext();\r\n\r\n //  Make a copy of the original add function \r\nconst originalUseEffect = React.useEffect;\r\nexport const _instrumentFunction = (react, span, original) => {\r\n\r\n    let wasError = false;\r\n    try {\r\n        return api.context.with(api.trace.setSpan(api.context.active(), span), () => {\r\n            return original();\r\n        });\r\n    }\r\n    catch (err) {\r\n        span.setAttribute(AttributeNames.REACT_ERROR, err.stack);\r\n        wasError = true;\r\n        throw err;\r\n    }\r\n    finally {\r\n        span.end();\r\n\r\n    }\r\n}\r\n\r\n/**\r\n     * Patches the render lifecycle method\r\n     */\r\nexport const _patchUseEffect = () => {\r\n    // return (original) => {\r\n    const plugin = this;\r\n    // return function patchUseEffect(...args) {\r\n\r\n    //setting the span \r\n    // const tracer = getTracing(\"example-react-load\", AttributeNames.EFFECT_SPAN);\r\n    // tracer.end();\r\n    // const apply = plugin._instrumentFunction(this, 'componentDidMount', tracer, () => {\r\n    //     return original.apply(this, args);\r\n    // });\r\n\r\n    // return original.apply(this, args);        \r\n    //  };\r\n    // };\r\n}\r\n\r\n\r\n\r\n/**\r\n     * Patches the setState function\r\n     */\r\nexport const _patchSetState = () => {\r\n    return (original) => {\r\n        const plugin = this;\r\n        return function patchSetState(...args) {\r\n            const tracer = getTracing(\"example-react-load\", AttributeNames.EFFECT_SPAN);\r\n            tracer.end();\r\n\r\n            //     const parentSpan = plugin._getParentSpan(this, AttributeNames_1.AttributeNames.UPDATING_SPAN);\r\n            return plugin._instrumentFunction(this, 'setState()', tracer, () => {\r\n                return original.apply(this, args);\r\n            });\r\n        };\r\n    };\r\n}\r\n\r\n/**\r\n    * patch function which wraps all the lifecycle methods\r\n    */\r\nexport const patch = () => {\r\n    console.log(\"Patch function called\")\r\n    console.log(\"context\", UserContext)\r\n\r\n    // // Make a copy of the original add function \r\n    // const origUseEffect = React.useEffect;\r\n    // React.useEffect = function() {\r\n    //     //console.log(`Adding the result of ${a} and ${b}`);\r\n    //     return origUseEffect();\r\n    // }\r\n    shimmer.wrap(React.useEffect, 'useEffect', _patchUseEffect());\r\n    //  shimmer.wrap(this, 'setState',_patchSetState());\r\n}\r\n\r\n\r\n\r\nexport const tracerUseEffect = () => {\r\n\r\n    console.log(\"tracerUseEffect function called\");\r\n   // const origUseEffect = React.useEffect;\r\n    React.useEffect = function (...args) {\r\n       console.log(\"Use effect called by monkey patching\");\r\n      //  return originalUseEffect();\r\n           return originalUseEffect.apply(React,args);\r\n    }\r\n    // Make a copy of the original add function \r\n    //const origAdd = useEffect;\r\n    //shimmer.wrap(useEffect(), 'useEffect', _patchUseEffect());\r\n    //  shimmer.wrap(this, 'setState',_patchSetState());\r\n\r\n}\r\n\r\n\r\n/**\r\n    * unpatch function to unwrap all the lifecycle methods\r\n    */\r\nexport const unpatch = () => {\r\n    console.log(\"Unpatch method called\")\r\n    shimmer.unwrap(this, 'useEffect');\r\n    //   shimmer.unwrap(this, 'setState');\r\n\r\n    // this._parentSpanMap = new WeakMap();\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}