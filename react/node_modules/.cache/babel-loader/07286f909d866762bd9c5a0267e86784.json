{"ast":null,"code":"var _this=this;import shimmer from\"shimmer\";import{AttributeNames}from\"./enum/AttributeNames\";import{getTracing}from\"./commonTracing\";import api from\"@opentelemetry/api\";import React from'react';import{useEffect}from'./Content';/**Steps to follow\r\n * start the span \r\n * set te parent space by setting the actice context \r\n * */export var UserContext=React.createContext();export var _instrumentFunction=function _instrumentFunction(react,span,original){var wasError=false;try{return api.context.with(api.trace.setSpan(api.context.active(),span),function(){return original();});}catch(err){span.setAttribute(AttributeNames.REACT_ERROR,err.stack);wasError=true;throw err;}finally{span.end();}};/**\r\n     * Patches the render lifecycle method\r\n     */export var _patchUseEffect=function _patchUseEffect(){// return (original) => {\nvar plugin=_this;// return function patchUseEffect(...args) {\n//setting the span \n// const tracer = getTracing(\"example-react-load\", AttributeNames.EFFECT_SPAN);\n// tracer.end();\n// const apply = plugin._instrumentFunction(this, 'componentDidMount', tracer, () => {\n//     return original.apply(this, args);\n// });\n// return original.apply(this, args);        \n//  };\n// };\n};/**\r\n     * Patches the setState function\r\n     */export var _patchSetState=function _patchSetState(){return function(original){var plugin=_this;return function patchSetState(){var _this2=this;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}var tracer=getTracing(\"example-react-load\",AttributeNames.EFFECT_SPAN);tracer.end();//     const parentSpan = plugin._getParentSpan(this, AttributeNames_1.AttributeNames.UPDATING_SPAN);\nreturn plugin._instrumentFunction(this,'setState()',tracer,function(){return original.apply(_this2,args);});};};};/**\r\n     * patch function which wraps all the lifecycle methods\r\n     */export var patch=function patch(){console.log(\"Patch function called\");console.log(\"context\",UserContext);// Make a copy of the original add function \nvar origAdd=useEffect;shimmer.wrap(origAdd,'useEffect',_patchUseEffect());//  shimmer.wrap(this, 'setState',_patchSetState());\n};/**\r\n     * unpatch function to unwrap all the lifecycle methods\r\n     */export var unpatch=function unpatch(){console.log(\"Unpatch method called\");shimmer.unwrap(_this,'useEffect');//   shimmer.unwrap(this, 'setState');\n// this._parentSpanMap = new WeakMap();\n};","map":{"version":3,"names":["shimmer","AttributeNames","getTracing","api","React","useEffect","UserContext","createContext","_instrumentFunction","react","span","original","wasError","context","with","trace","setSpan","active","err","setAttribute","REACT_ERROR","stack","end","_patchUseEffect","plugin","_patchSetState","patchSetState","args","tracer","EFFECT_SPAN","apply","patch","console","log","origAdd","wrap","unpatch","unwrap"],"sources":["C:/React/cloned telemetry/opentelemetry-js-contrib/examples/react-load/react/src/automation.jsx"],"sourcesContent":["import shimmer from \"shimmer\";\r\nimport { AttributeNames } from \"./enum/AttributeNames\";\r\nimport { getTracing } from \"./commonTracing\";\r\nimport api from \"@opentelemetry/api\";\r\nimport React from 'react';\r\nimport {useEffect} from './Content'\r\n/**Steps to follow\r\n * start the span \r\n * set te parent space by setting the actice context \r\n * */ \r\n export const UserContext = React.createContext();\r\n export const _instrumentFunction=(react, span , original)=> {\r\n\r\n    let wasError = false;\r\n    try {\r\n        return api.context.with(api.trace.setSpan(api.context.active(), span), () => {\r\n            return original();\r\n        });\r\n    }\r\n    catch (err) {\r\n        span.setAttribute(AttributeNames.REACT_ERROR, err.stack);\r\n        wasError = true;\r\n        throw err;\r\n    }\r\n    finally {\r\n        span.end();\r\n      \r\n    }\r\n}\r\n\r\n/**\r\n     * Patches the render lifecycle method\r\n     */\r\n export const _patchUseEffect=()=> {\r\n    // return (original) => {\r\n        const plugin = this;\r\n       // return function patchUseEffect(...args) {\r\n         \r\n               //setting the span \r\n                // const tracer = getTracing(\"example-react-load\", AttributeNames.EFFECT_SPAN);\r\n                // tracer.end();\r\n                // const apply = plugin._instrumentFunction(this, 'componentDidMount', tracer, () => {\r\n                //     return original.apply(this, args);\r\n                // });\r\n          \r\n                // return original.apply(this, args);        \r\n      //  };\r\n   // };\r\n}\r\n\r\n\r\n\r\n/**\r\n     * Patches the setState function\r\n     */\r\n export const _patchSetState=()=> {\r\n    return (original) => {\r\n        const plugin = this;\r\n        return function patchSetState(...args) {\r\n            const tracer = getTracing(\"example-react-load\", AttributeNames.EFFECT_SPAN);\r\n            tracer.end();\r\n           \r\n        //     const parentSpan = plugin._getParentSpan(this, AttributeNames_1.AttributeNames.UPDATING_SPAN);\r\n            return plugin._instrumentFunction(this, 'setState()', tracer, () => {\r\n                return original.apply(this, args);\r\n            });\r\n         };\r\n    };\r\n}\r\n\r\n /**\r\n     * patch function which wraps all the lifecycle methods\r\n     */\r\nexport const  patch=()=> {\r\nconsole.log(\"Patch function called\")\r\nconsole.log(\"context\",UserContext)\r\n\r\n// Make a copy of the original add function \r\nconst origAdd = useEffect;\r\n    shimmer.wrap(origAdd, 'useEffect',_patchUseEffect());\r\n  //  shimmer.wrap(this, 'setState',_patchSetState());\r\n}\r\n\r\n /**\r\n     * unpatch function to unwrap all the lifecycle methods\r\n     */\r\n  export const unpatch=()=> {\r\n    console.log(\"Unpatch method called\")\r\n    shimmer.unwrap(this, 'useEffect');\r\n //   shimmer.unwrap(this, 'setState');\r\n   \r\n    // this._parentSpanMap = new WeakMap();\r\n}"],"mappings":"eAAA,MAAOA,QAAP,KAAoB,SAApB,CACA,OAASC,cAAT,KAA+B,uBAA/B,CACA,OAASC,UAAT,KAA2B,iBAA3B,CACA,MAAOC,IAAP,KAAgB,oBAAhB,CACA,MAAOC,MAAP,KAAkB,OAAlB,CACA,OAAQC,SAAR,KAAwB,WAAxB,CACA;AACA;AACA;AACA,KACC,MAAO,IAAMC,YAAW,CAAGF,KAAK,CAACG,aAAN,EAApB,CACP,MAAO,IAAMC,oBAAmB,CAAC,QAApBA,oBAAoB,CAACC,KAAD,CAAQC,IAAR,CAAeC,QAAf,CAA2B,CAEzD,GAAIC,SAAQ,CAAG,KAAf,CACA,GAAI,CACA,MAAOT,IAAG,CAACU,OAAJ,CAAYC,IAAZ,CAAiBX,GAAG,CAACY,KAAJ,CAAUC,OAAV,CAAkBb,GAAG,CAACU,OAAJ,CAAYI,MAAZ,EAAlB,CAAwCP,IAAxC,CAAjB,CAAgE,UAAM,CACzE,MAAOC,SAAQ,EAAf,CACH,CAFM,CAAP,CAGH,CACD,MAAOO,GAAP,CAAY,CACRR,IAAI,CAACS,YAAL,CAAkBlB,cAAc,CAACmB,WAAjC,CAA8CF,GAAG,CAACG,KAAlD,EACAT,QAAQ,CAAG,IAAX,CACA,KAAMM,IAAN,CACH,CATD,OAUQ,CACJR,IAAI,CAACY,GAAL,GAEH,CACJ,CAjBO,CAmBR;AACA;AACA,OACC,MAAO,IAAMC,gBAAe,CAAC,QAAhBA,gBAAgB,EAAK,CAC/B;AACI,GAAMC,OAAM,CAAG,KAAf,CACD;AAEQ;AACC;AACA;AACA;AACA;AACA;AAEA;AACV;AACH;AACF,CAfO,CAmBR;AACA;AACA,OACC,MAAO,IAAMC,eAAc,CAAC,QAAfA,eAAe,EAAK,CAC9B,MAAO,UAACd,QAAD,CAAc,CACjB,GAAMa,OAAM,CAAG,KAAf,CACA,MAAO,SAASE,cAAT,EAAgC,+CAANC,IAAM,0CAANA,IAAM,wBACnC,GAAMC,OAAM,CAAG1B,UAAU,CAAC,oBAAD,CAAuBD,cAAc,CAAC4B,WAAtC,CAAzB,CACAD,MAAM,CAACN,GAAP,GAEJ;AACI,MAAOE,OAAM,CAAChB,mBAAP,CAA2B,IAA3B,CAAiC,YAAjC,CAA+CoB,MAA/C,CAAuD,UAAM,CAChE,MAAOjB,SAAQ,CAACmB,KAAT,CAAe,MAAf,CAAqBH,IAArB,CAAP,CACH,CAFM,CAAP,CAGF,CARF,CASH,CAXD,CAYH,CAbO,CAeP;AACD;AACA,OACA,MAAO,IAAOI,MAAK,CAAC,QAANA,MAAM,EAAK,CACzBC,OAAO,CAACC,GAAR,CAAY,uBAAZ,EACAD,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAsB3B,WAAtB,EAEA;AACA,GAAM4B,QAAO,CAAG7B,SAAhB,CACIL,OAAO,CAACmC,IAAR,CAAaD,OAAb,CAAsB,WAAtB,CAAkCX,eAAe,EAAjD,EACF;AACD,CARM,CAUN;AACD;AACA,OACE,MAAO,IAAMa,QAAO,CAAC,QAARA,QAAQ,EAAK,CACxBJ,OAAO,CAACC,GAAR,CAAY,uBAAZ,EACAjC,OAAO,CAACqC,MAAR,CAAe,KAAf,CAAqB,WAArB,EACH;AAEG;AACH,CANQ"},"metadata":{},"sourceType":"module"}